<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="description" content="Introduction to Machine">

        <meta property="og:site_name" content="Laravel USSD"/>
        <meta property="og:title" content="Machine | Laravel USSD"/>
        <meta property="og:description" content="Introduction to Machine"/>
        <meta property="og:url" content="https://sparors.github.io/ussd-docs/docs/machine"/>
        <meta property="og:image" content="/ussd-docs/assets/img/logo.png"/>
        <meta property="og:type" content="website"/>

        <meta name="twitter:image:alt" content="Laravel USSD">
        <meta name="twitter:card" content="summary_large_image">

                    <meta name="generator" content="tighten_jigsaw_doc">
        
        <title>Laravel USSD | Machine</title>

        <link rel="home" href="https://sparors.github.io/ussd-docs">
        <link rel="icon" href="/ussd-docs/favicon.ico">

        
                    <!-- Insert analytics code here -->
        
        <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="/ussd-docs/assets/build/css/main.css?id=36bd75733674d1919eaa">

                    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
            </head>

    <body class="flex flex-col justify-between min-h-screen bg-gray-100 text-gray-800 leading-normal font-sans">
        <header class="flex items-center shadow bg-white border-b h-24 mb-8 py-4" role="banner">
            <div class="container flex items-center max-w-8xl mx-auto px-4 lg:px-8">
                <div class="flex items-center">
                    <a href="/ussd-docs/" title="Laravel USSD home" class="inline-flex items-center">
                        <img class="h-8 md:h-10 mr-3" src="/ussd-docs/assets/img/logo.svg" alt="Laravel USSD logo" />

                        <h1 class="text-lg md:text-2xl text-blue-900 font-semibold hover:text-blue-600 my-0 pr-4">Laravel USSD</h1>
                    </a>
                </div>

                <div class="flex flex-1 justify-end items-center text-right md:pl-10">
                                            <button
    title="Start searching"
    type="button"
    class="flex md:hidden bg-gray-100 hover:bg-blue-100 justify-center items-center border border-gray-500 rounded-full focus:outline-none h-10 px-3"
    onclick="searchInput.toggle()"
>
    <img src="/assets/img/magnifying-glass.svg" alt="search icon" class="h-4 w-4 max-w-none">
</button>

<div id="js-search-input" class="docsearch-input__wrapper hidden md:block">
    <label for="search" class="hidden">Search</label>

    <input
        id="docsearch-input"
        class="docsearch-input relative block h-10 transition-fast w-full lg:w-1/2 xl:w-1/3 bg-gray-100 outline-none rounded-full text-gray-700 border border-gray-500 focus:border-blue-400 ml-auto px-4 pb-0"
        name="docsearch"
        type="text"
        placeholder="Search"
    >

    <button
        class="md:hidden absolute pin-t pin-r h-full font-light text-3xl text-blue-500 hover:text-blue-600 focus:outline-none -mt-px pr-7"
        onclick="searchInput.toggle()"
    >&times;</button>
</div>

                                    </div>
            </div>

                <button class="flex justify-center items-center bg-blue-500 border border-blue-500 h-10 mr-4 px-5 rounded-full lg:hidden focus:outline-none"
    onclick="navMenu.toggle()"
>
    <svg id="js-nav-menu-show" xmlns="http://www.w3.org/2000/svg"
        class="fill-current text-white h-9 w-4" viewBox="0 0 32 32"
    >
        <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>

    <svg id="js-nav-menu-hide" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current text-white h-9 w-4" viewBox="0 0 36 30"
    >
        <polygon points="32.8,4.4 28.6,0.2 18,10.8 7.4,0.2 3.2,4.4 13.8,15 3.2,25.6 7.4,29.8 18,19.2 28.6,29.8 32.8,25.6 22.2,15 "/>
    </svg>
</button>

        </header>

        <main role="main" class="w-full flex-auto">
            <section class="container max-w-8xl mx-auto px-6 md:px-8 py-4">
    <div class="flex flex-col lg:flex-row">
        <nav id="js-nav-menu" class="nav-menu hidden lg:block">
            <ul class="my-0">
            <li class="pl-4">
            
        <p class="nav-menu__item text-gray-600">GETTING STARTED</p>
    
            
        <ul class="my-0">
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/requirements"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Requirements
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/installation"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Installation
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/questions-issues"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Questions and Issues
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <p class="nav-menu__item text-gray-600">CORE CONCEPTS</p>
    
            
        <ul class="my-0">
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/state"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            State
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/menu"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Menu
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/action"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Action
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/decision"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Decision
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/record"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Record
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/machine"
            class="lvl1  active font-semibold text-blue-500 nav-menu__item hover:text-blue-500"
        >
            Machine
        </a>
    
    </li>
    </ul>
    </li>
    </ul>
        </nav>

        <div class="DocSearch-content w-full lg:w-3/5 break-words pb-16 lg:pl-4" v-pre>
            <h1 id="machine">Machine</h1>

<p>After creating the various states and linking them, we are set to launch our 
ussd application. State classes are interconnected web of nodes but 
does not have any idea on how to run.</p>

<p>What do i do next?</p>

<p>Meet Machine, the robust application runner.</p>

<h2 id="machine-how">How does it work?</h2>

<p>Machine takes arguments which are crusial to run the application when created.
It does all the magic for you while you sit back and relax.</p>

<p>Machine will take the users request and interpret it and call the necessary 
state class to hand over the request and terminate it afterwards. 
Machine is responsible for navigating the states with the user.</p>

<h2 id="machine-complex">Seem complex?</h2>

<p>Don't worry, it is easier than it sound. Let's create a machine to prove it.</p>

<h2 id="creating-machine">Creating Machine</h2>

<p>Typically, machines are created in a controller or in your routes file.</p>

<p>Use the Ussd Facade and call the function machine. That's all it takes.</p>

<pre><code class="language-php">&lt;?php
use Sparors\Ussd\Facade\Ussd;

Ussd::machine();
</code></pre>

<h3 id="machine-session-id">Session id</h3>

<p>Machine Requires a session id to work. You can set it on the 
machine call like this.</p>

<pre><code class="language-php">Ussd::machine()-&gt;setSessionId($request-&gt;session_id);
</code></pre>

<h4 id="machine-session-id-req">Session id from request</h4>

<p>You may want to set the session id straight for the request without having 
to use a request object. To achieve this, call 
setSessionIdFromRequest and specify the request key.</p>

<pre><code class="language-php">Ussd::machine()-&gt;setSessionIdFromRequest('sesssion_id');
</code></pre>

<h3 id="machine-input">User Input</h3>

<p>Another important variable is the Input from the user. That too can be set like the session id.</p>

<pre><code class="language-php">Ussd::machine()-&gt;setInput($request-&gt;user_input);

// or 

Ussd::machine()-&gt;setInputFromRequest('user_input');
</code></pre>

<h3 id="machine-other-params">Other parameters</h3>

<p>Other parameters like phoneNumber and network are also available to set when needed.</p>

<pre><code class="language-php">Ussd::machine()-&gt;setPhoneNumber($request-&gt;phone_number);
Ussd::machine()-&gt;setNetwork($request-&gt;network);

// or 

Ussd::machine()-&gt;setPhoneNumberFromRequest('phone_number');
Ussd::machine()-&gt;setNetworkFromRequest('network');
</code></pre>

<h3 id="machine-chained">Parameters can be chained</h3>

<pre><code class="language-php">Ussd::machine()-&gt;setPhoneNumber($request-&gt;phone_number)-&gt;setNetworkFromRequest('network');
</code></pre>

<h3 id="machine-set">Parameters can be set at once</h3>

<pre><code class="language-php">Ussd:machine()-&gt;set([
    'phone_number' =&gt; $request-&gt;phone_number,
    'network' =&gt; $request-&gt;operatorNetwork,
    'session_id' =&gt; $request-&gt;sessionID,
    'input' =&gt; $request-&gt;user_input,
]);

// or

/* 
    Keys are converted to camel-case.
    The available key options are:
    phoneNumber, input, network, sessionId
*/
Ussd:machine()-&gt;setFromRequest([
    'phone_number', // Get request with key phone_number and set it as phoneNumber
    'input' =&gt; 'user_input', // Get request with key user_input and set it as the input
    'network',
    'session_id',
]);
</code></pre>

<h3 id="machine-store">Choose cache store</h3>

<p>When you don't specify the cache store, the store variable in <em>config/ussd.php</em> is used. When specified the machine uses the specified one. To specify, use <code>setStore</code> method.</p>

<pre><code class="language-php">Ussd:machine()-&gt;setStore('redis');
</code></pre>

<h3 id="machine-state-init">Initial State</h3>

<p>The machine can not run without tell it where to start from.
When you do, the other states will be determined from user interraction 
with the USSD.</p>

<pre><code class="language-php">Ussd:machine()-&gt;setInitialState(Welcome::class);
</code></pre>

<h3 id="machine-output">Output of the machine</h3>

<p>The machine will generate an array as the out put with two property <code>message</code> and <code>code</code>. The message is the string to be responsed to the mobile operator and the code show weather to provide an input or not to the user.</p>

<pre><code class="language-php">&lt;?php

use Illuminate\Support\Facades\Route;
use Sparors\Ussd\Facades\Ussd;
use App\Http\Ussd\States\Welcome;

Route::get('/', function () {
    $ussd = Ussd::machine()
        -&gt;setFromRequest([
            'phone_number',
            'input' =&gt; 'user_input',
            'network',
            'session_id',
        ])
        -&gt;setInitialState(Welcome::class);

    return response()-&gt;json($ussd-&gt;run());
});

/*
    output

    {
        "message": "Welcome class over here"
        "action": "input"
    }
*/
</code></pre>

<blockquote>
  <p>NB: action <code>'input'</code> for input, <code>'prompt'</code> for no input.</p>
</blockquote>

<h3 id="machine-out-manupulate">What ! my operatory does not understand that response</h3>

<p>Don't worry, we know you can not tell your ussd operator to change their 
structure just to make your application work. You can set how to responsed 
to your operator by using a callable. Below is an example.</p>

<pre><code class="language-php">&lt;?php

use Illuminate\Support\Facades\Route;
use Sparors\Ussd\Facades\Ussd;
use App\Http\Ussd\States\Welcome;

Route::get('/', function () {
    $ussd = Ussd::machine()
        -&gt;setFromRequest([
            'phone_number' =&gt; 'msisdn',
            'input' =&gt; 'msg',
            'network',
            'session_id' =&gt; 'UserSessionID',
        ])
        -&gt;setInitialState(Welcome::class)
        -&gt;setResponse(function(string $message, string $action) {
            return [
                'USSDResp' =&gt; [
                    'action' =&gt; $action,
                    'menus' =&gt; '',
                    'title' =&gt; $message,
                ];
            ];
        });

    return response()-&gt;json($ussd-&gt;run());
});

/*
    output

    {
        "USSDResp": {
            "action": "input",
            "menus": "",
            "title": "Welcome class over here"
        }
    }
*/
</code></pre>
        </div>
    </div>
</section>
        </main>

        <script src="/ussd-docs/assets/build/js/main.js?id=8b1f137f16842f6fe7d3"></script>

        <script>
    const navMenu = {
        toggle() {
            const menu = document.getElementById('js-nav-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
        },
    }
</script>
            <script type="text/javascript">
            docsearch({
                apiKey: '74d3945d9e6d08bcb8cd48fe58d4a948',
                indexName: 'sparors_ussd',
                inputSelector: '#docsearch-input',
                debug: false // Set debug to true if you want to inspect the dropdown
            });

            const searchInput = {
                toggle() {
                    const menu = document.getElementById('js-search-input');
                    menu.classList.toggle('hidden');
                    menu.classList.toggle('md:block');
                    document.getElementById('docsearch-input').focus();
                },
            }
        </script>
    
        <footer class="bg-white text-center text-sm mt-12 py-4" role="contentinfo">
            <ul class="flex flex-col md:flex-row justify-center">
                <li class="md:mr-2">
                    &copy; <a href="https://sparors.github.io" title="Sparors website">Sparors</a> 2020.
                </li>

                <li>
                    Built with <a href="http://jigsaw.tighten.co" title="Jigsaw by Tighten">Jigsaw</a>
                    and <a href="https://tailwindcss.com" title="Tailwind CSS, a utility-first CSS framework">Tailwind CSS</a>.
                </li>
            </ul>
        </footer>
    </body>
</html>
