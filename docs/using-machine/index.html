<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="description" content="Smart Worker">

        <meta property="og:site_name" content="Laravel Ussd"/>
        <meta property="og:title" content="Running the App | Laravel Ussd"/>
        <meta property="og:description" content="Smart Worker"/>
        <meta property="og:url" content="https://sparors.github.io/ussd-docs/docs/using-machine"/>
        <meta property="og:image" content="/ussd-docs/assets/img/logo.png"/>
        <meta property="og:type" content="website"/>

        <meta name="twitter:image:alt" content="Laravel Ussd">
        <meta name="twitter:card" content="summary_large_image">

        
        <title>Laravel Ussd | Running the App</title>

        <link rel="home" href="https://sparors.github.io/ussd-docs">
        <link rel="icon" href="/ussd-docs/favicon.ico">

        
                    <!-- Insert analytics code here -->
        
        <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,300i,400,400i,700,700i,800,800i" rel="stylesheet">
        <link rel="stylesheet" href="/ussd-docs/assets/build/css/main.css?id=6f5e2f47827cfb3cc455">

            </head>

    <body class="flex flex-col justify-between min-h-screen bg-gray-100 text-gray-800 leading-normal font-sans">
        <header class="flex items-center shadow bg-white border-b h-24 mb-8 py-4" role="banner">
            <div class="container flex items-center max-w-8xl mx-auto px-4 lg:px-8">
                <div class="flex items-center">
                    <a href="/ussd-docs/" title="Laravel Ussd home" class="inline-flex items-center">
                        <img class="h-8 md:h-10 mr-3" src="/ussd-docs/assets/img/logo.svg" alt="Laravel Ussd logo" />

                        <h1 class="text-lg md:text-2xl text-blue-900 font-semibold hover:text-blue-600 my-0 pr-4">Laravel Ussd</h1>
                    </a>
                </div>

                <div class="flex flex-1 justify-end items-center text-right md:pl-10">
                                    </div>
            </div>

                <button class="flex justify-center items-center bg-blue-500 border border-blue-500 h-10 mr-4 px-5 rounded-full lg:hidden focus:outline-none"
    onclick="navMenu.toggle()"
>
    <svg id="js-nav-menu-show" xmlns="http://www.w3.org/2000/svg"
        class="fill-current text-white h-9 w-4" viewBox="0 0 32 32"
    >
        <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>

    <svg id="js-nav-menu-hide" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current text-white h-9 w-4" viewBox="0 0 36 30"
    >
        <polygon points="32.8,4.4 28.6,0.2 18,10.8 7.4,0.2 3.2,4.4 13.8,15 3.2,25.6 7.4,29.8 18,19.2 28.6,29.8 32.8,25.6 22.2,15 "/>
    </svg>
</button>

        </header>

        <main role="main" class="w-full flex-auto">
            <section class="container max-w-8xl mx-auto px-6 md:px-8 py-4">
    <div class="flex flex-col lg:flex-row">
        <nav id="js-nav-menu" class="nav-menu hidden lg:block">
            <ul class="my-0">
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/getting-started"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Getting Started
        </a>
    
            
        <ul class="my-0">
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/requirements"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Requirements
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/installation"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Installation
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/questions-issues"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Questions and Issues
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/states"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            States
        </a>
    
            
        <ul class="my-0">
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/creating-states"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Creating States
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/understanding-states"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Understanding  States
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/menus"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Menus
        </a>
    
            
        <ul class="my-0">
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/creating-menus"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Creating Menus
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/decision"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Decision
        </a>
    
            
        <ul class="my-0">
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/using-decision"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Creating Links with decision
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/record"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Record
        </a>
    
            
        <ul class="my-0">
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/using-record"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Saving Data with record
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/machine"
            class="lvl0 lvl0-active  nav-menu__item hover:text-blue-500"
        >
            Machine
        </a>
    
            
        <ul class="my-0">
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/using-machine"
            class="lvl1  active font-semibold text-blue-500 nav-menu__item hover:text-blue-500"
        >
            Running the App
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <a href="/ussd-docs/docs/api"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Api Reference
        </a>
    
    </li>
    </ul>
        </nav>

        <div class="DocSearch-content w-full lg:w-3/5 break-words pb-16 lg:pl-4" v-pre>
            <h1 id="creating-machince">Creating Machine</h1>

<p>Typically, you will create a machine in a controller or in your routes file.</p>

<p>Use the Ussd Facade and call the function machine. That all.</p>

<pre><code class="language-php">Ussd::machine();
</code></pre>

<h2>Session id</h2>

<p>Machine Requires a session id to work. you can set it on the machine call like this.</p>

<pre><code class="language-php">Ussd::machine()-&gt;setSessionId($request-&gt;session_id);
</code></pre>

<h3>Session id from request</h3>

<p>You may want to set the session id straight for the request with having to use a request object. To achieve this, call setSessionIdFromRequest and specify the request key.</p>

<pre><code class="language-php">Ussd::machine()-&gt;setSessionIdFromRequest('sesssio_id');
</code></pre>

<h2>UserInput</h2>

<p>Another important variable is the Input from the user. That too can be set like the session id.</p>

<pre><code class="language-php">Ussd::machine()-&gt;setInput($request-&gt;user_input);

// or 

Ussd::machine()-&gt;setInputFromRequest('user_input');
</code></pre>

<h2>Other parameters</h2>

<p>Other parameters like phoneNumbe and network are also available to set when needed.</p>

<pre><code class="language-php">Ussd::machine()-&gt;setPhoneNumber($request-&gt;phone_number);
Ussd::machine()-&gt;setNetwork($request-&gt;network);

// or 

Ussd::machine()-&gt;setPhoneNumberFromRequest('phone_number');
Ussd::machine()-&gt;setNetworkFromRequest('network');
</code></pre>

<h2>Parameters can be chained</h2>

<pre><code class="language-php">Ussd::machine()-&gt;setPhoneNumber($request-&gt;phone_number)-&gt;setNetworkFromRequest('network');
</code></pre>

<h2>Rarameters can be set at once</h2>

<pre><code class="language-php">Ussd:machine()-&gt;set([
    'phone_number' =&gt; $request-&gt;phone_number,
    'network' =&gt; $request-&gt;operatorNetwork,
    'session_id' =&gt; $request-&gt;sessionID,
    'input' =&gt; $request-&gt;user_input,
]);

// or

/* 
    When key from request can be converted to the same camel
    as phoneNumber, network, sessionId, input, then
    there is no need to use associative array.
    on the value is enough.
*/
Ussd:machine()-&gt;setFromRequest([
    'phone_number',
    'input' =&gt; 'user_input',
    'network',
    'session_id',
]);
</code></pre>

<h2>Choose cache store</h2>

<p>When you don't specify the cache store, the store variable in <em>config/ussd.php</em> is used. When specified the machine uses the specified one. But you can override that with setStore.</p>

<pre><code class="language-php">Ussd:machine()-&gt;setStore('redis');
</code></pre>

<h2>Initial State</h2>

<p>The machine can not run without tell it where to start from. When you do, don't worry. You don't need to tell it of the other states, it will automatically know and work accordingly.</p>

<pre><code class="language-php">Ussd:machine()-&gt;setInitialState(Welcome::class);
</code></pre>

<h2>Output of the machine</h2>

<p>The machine will generate an array as the out put with two property <code>message</code> and <code>code</code>. The message is the string to be responsed to the mobile operator and the code show waether to provide an input or not to the user.</p>

<pre><code class="language-php">&lt;?php

use App\Ussd\Welcome;
use Illuminate\Support\Facades\Route;
use Sparors\Ussd\Facades\Ussd;

Route::get('/', function () {
    $ussd = Ussd::machine()
        -&gt;setFromRequest([
            'phone_number',
            'input' =&gt; 'user_input',
            'network', 'session_id',
        ])
        -&gt;setInitialState(Welcome::class);

    return response()-&gt;json($ussd-&gt;run());
});

/*
    output

    {
        "message": "Welcome class over here"
        "code": 1
    }
*/
</code></pre>

<blockquote>
  <p>NB: code 1 for input, 2 for no input.</p>
</blockquote>

<h2>what ! my operatory does not understand that response</h2>

<p>Don't worry, we know you can not tell your ussd operator to change their structure just to make your application work. You can set how to responsed to your operator by using a callable. Below is an example.</p>

<pre><code class="language-php">&lt;?php

use App\Ussd\Welcome;
use Illuminate\Support\Facades\Route;
use Sparors\Ussd\Facades\Ussd;

Route::get('/', function () {
    $ussd = Ussd::machine()
        -&gt;setFromRequest([
            'phone_number' =&gt; 'msisdn',
            'input' =&gt; 'msg',
            'network',
            'session_id' =&gt; 'UserSessionID',
        ])
        -&gt;setInitialState(Welcome::class)
        -&gt;setResponse(function(string $message, int $code) {
            return [
                'USSDResp' =&gt; [
                    'action' =&gt; $code === 2 ? 'prompt' : 'input',
                    'menus' =&gt; '',
                    'title' =&gt; $message,
                ];
            ];
        });

    return response()-&gt;json($ussd-&gt;run());
});

/*
    output

    {
        "USSDResp": {
            "action": "input",
            "menus": "",
            "title": "Welcome class over here"
        }
    }
*/
</code></pre>
        </div>
    </div>
</section>
        </main>

        <script src="/ussd-docs/assets/build/js/main.js?id=8b1f137f16842f6fe7d3"></script>

        <script>
    const navMenu = {
        toggle() {
            const menu = document.getElementById('js-nav-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
        },
    }
</script>

        <footer class="bg-white text-center text-sm mt-12 py-4" role="contentinfo">
            <ul class="flex flex-col md:flex-row justify-center">
                <li class="md:mr-2">
                    &copy; <a href="https://sparors.github.io" title="Sparors website">Sparors</a> 2020.
                </li>

                <li>
                    Built with <a href="http://jigsaw.tighten.co" title="Jigsaw by Tighten">Jigsaw</a>
                    and <a href="https://tailwindcss.com" title="Tailwind CSS, a utility-first CSS framework">Tailwind CSS</a>.
                </li>
            </ul>
        </footer>
    </body>
</html>
